---
tags:
  - è¯»ä¹¦ç¬”è®°
  - éœ€è¦æ•´ç†
---

# ğŸ“– æ•°æ®åº“ç³»ç»Ÿæ¦‚å¿µ

## å…³ç³»ä»£æ•°

| Operation | Description | Symbol |
| --- | --- | --- |
| Select | satisfy a **predicate** | $\sigma_{predicate}(relation)$ |
| Project | select a subset of **attributes** | $\Pi_{attribute-list}(relation)$ |
| Cartesian-Product | combine two relations | $relation_1 \times relation_2$ |
| Join | combine two relations | $\sigma_{common\ predicate}(relation_1\times relation_2) = relation_1 \bowtie_{predicate} relation_2$ |
| Basic Set Operation | union, intersection, difference | $relation_1 \cup relation_2, relation_1 \cap relation_2, relation_1 - relation_2$ |
| Assignment | assign a new name to a relation | $new\_relation \leftarrow expression$ |
| Rename | rename the attributes of a relation | $\rho_{new\_name(new\_attribute\_list)}(relation)$ |

## ç¬¬å››ç« 

!!! abstract

    - Join
    - View
    - Index
    - Transaction
    - Integrity Constraint
    - Data Types and Schemas
    - Authorization

### è”ç»“ Join

- è”ç»“çš„ç§ç±»ï¼šinnerã€left outerã€right outerã€full outer
- è”ç»“çš„æ¡ä»¶ï¼šnaturalã€onã€using

#### è‡ªç„¶è”ç»“ï¼šåŒ¹é…å…¬å…±å±æ€§ç›¸åŒçš„å…ƒç»„

æ³¨æ„ä¸‹é¢ä¸¤ä¸ªçš„ä¸åŒï¼š

```sql
from student natural join takes natural join course

from student natural join takes, course
where takes.course_id = course.course_id
```

ä¸ºé˜²æ­¢ä¸Šé¢çš„æƒ…å†µï¼Œä¸€èˆ¬ä½¿ç”¨ `using` æŒ‡å®šè”ç»“åˆ—ï¼š

```sql
from (student natural join takes) natural join course using (course_id)
```

ä½¿ç”¨ `on` æŒ‡å®šè”ç»“æ¡ä»¶ï¼š

```sql
from student join takes on student.ID = takes.ID
```

#### å¤–éƒ¨è”ç»“

å¯ä»¥ç†è§£ä¸ºï¼šå¦‚æœæ²¡æœ‰åŒ¹é…çš„å…ƒç»„ï¼Œå°±ç”¨ NULL å¡«å……å…¶ä»–å±æ€§ã€‚ä¿ç•™æ‰€æœ‰ä¿¡æ¯ã€‚

æœ‰ leftã€rightã€full ä¸‰ç§ã€‚å…³ç³»ä»£æ•°ç¬¦å·ï¼šâŸ•ã€âŸ–ã€âŸ—ã€‚

#### å†…éƒ¨è”ç»“

ä½¿ç”¨è‡ªç„¶è”ç»“æ—¶ï¼Œä¼šè‡ªåŠ¨å»æ‰é‡å¤çš„ï¼ˆè”ç»“æ‰€ä½¿ç”¨çš„ï¼‰åˆ—ã€‚å†…éƒ¨è”ç»“åˆ™ä¿ç•™ã€‚

### è§†å›¾ View

```sql
create view v as <query expression>
```

ç›¸å½“äºå­˜å‚¨äº†ä¸€ä¸ªè¡¨è¾¾å¼ã€‚

Materialized viewï¼šå­˜å‚¨äº†ç»“æœï¼Œè€Œä¸æ˜¯è¡¨è¾¾å¼ã€‚

å…è®¸ç®€å•è§†å›¾çš„æ›´æ–°ã€‚

```sql
insert into faculty values ('30765', 'Green', 'Music');
```

### ç´¢å¼• Index

```sql
create index <name> on <relation-name> (attribute);
```

### äº‹åŠ¡ Transaction

ä½œä¸ºä¸€ä¸ªæ•´ä½“æ‰§è¡Œçš„ä¸€ç»„æ“ä½œã€‚

äº‹åŠ¡çš„ç»“å°¾å¿…é¡»æ˜¯ commit æˆ– rollbackã€‚

### å®Œæ•´æ€§çº¦æŸ Integrity Constraint

å¸¸è§ï¼š

```sql
not null
primary key
unique(a1, a2, ...)
check(predicate)
```

- unique æŒ‡æ˜äº† superkeyï¼Œå…¶ä¸­ candidate key å¯ä»¥æ˜¯ç©ºçš„ï¼Œprimary key ä¸å¯ä»¥ã€‚
- check å¯ä»¥å«æœ‰æŸ¥è¯¢ï¼Œæ¯”å¦‚

```sql
check(time_slot_id in (select time_slot_id from time_slot))
```

#### å¼•ç”¨å®Œæ•´æ€§ Referential Integrity

é»˜è®¤æ‹’ç»ã€‚

cascade çº§è”æ“ä½œ

```sql
foreign key (a1, a2, ...) references r(b1, b2, ...)
    on delete cascade
    on update cascade
```

#### æ–­è¨€ Assertion

æ•°æ®åº“å§‹ç»ˆæ»¡è¶³çš„æ¡ä»¶ã€‚

```sql
create assertion <assertion-name> check (predicate)
```

### è§¦å‘å™¨ Triggers

å¯¹æ•°æ®åº“è¿›è¡Œä¿®æ”¹æ—¶çš„å‰¯ä½œç”¨ã€‚

ECAï¼šEvent-Condition-Action

- äº‹ä»¶ï¼šinsertã€deleteã€update
    - å‘ç”Ÿå‰åï¼š`after update of salary on instructor`
    - å¼•ç”¨å‘ç”Ÿå‰åçš„å€¼ï¼š`new.salary`ã€`old.salary`

```sql
create trigger setnull_trigger before update of takes
    referencing new row as nrow
    for each row
        when (nrow.grade= ' ')
        begin atomic
            set nrow.grade = null;
end;
```

### æ•°æ®ç±»å‹å’Œæ¨¡å¼ Data Types and Schemas

- dateã€timeã€timestampã€interval
- Large Object: BLOB (binary)ã€CLOB (character)ï¼ŒæŸ¥è¯¢æ—¶è¿”å›å®šä½å™¨ pointer è€Œä¸æ˜¯å®é™…æ•°æ®
- è‡ªå®šä¹‰ï¼š
    - `create type Dollars as numeric (12,2) final`
    - `create domain person_name char(20) not null`

### æˆæƒ Authorization

- æƒé™ privilegeï¼šreadã€insertã€updateã€delete
    - indexã€resourcesã€alterationã€drop

```sql
grant <privilege list> on <relation or view> to <user list>
grant select on  department to Amit,Satoshi
revoke <privilege list> on <relation or view> from <user list>
create role <name>
grant <role> to <users>
```

## ç¬¬äº”ç« 

!!! abstract

    - SQL ç¼–ç¨‹
    - å‡½æ•°å’Œè¿‡ç¨‹

### JDBC

- Open connection
- Create statement
- Execute query
- Fetch result
- Handle Errors

#### SQL Injection

ä¸ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œè€Œæ˜¯ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ã€‚

```java
PreparedStatement pstmt = conn.prepareStatement("select * from student where ID = ?");
pstmt.setString(1, "12345");
ResultSet rs = pstmt.executeQuery();
```

è¿™é‡Œçš„ `?` å°±æ˜¯å‚æ•°ã€‚

```java
setString
setInt
setDate
```

#### ç»“æœ

```java
while (rs.next()) {
    System.out.println(rs.getString("ID"));
}
```

å…ƒæ•°æ® `.getMetaData()`ï¼š

```java
ResultSet rsmd = rs.getMetaData();
int numCols = rsmd.getColumnCount();
for (int i = 1; i <= numCols; i++) {
    System.out.print(rsmd.getColumnName(i) + "\t");
    System.out.print(rsmd.getColumnTypeName(i) + "\t");
}
```

#### äº‹åŠ¡

```java
conn.setAutoCommit(false);
conn.commit();
conn.rollback();
```

### å‡½æ•°ä¸è¿‡ç¨‹

```sql
create function f (a1 type1, a2 type2, ...) returns type
    begin
    declare v1 type1;
        select ... into v1
        from ...
        where ...;
    return v1;
end;

select ...
from ...
where f(a1, a2, ...) = ...;
```

è¡¨å‡½æ•°ï¼š

```sql
create function f (a1 type1, a2 type2, ...) returns table (c1 type1, c2 type2, ...)
    begin
    ...
end;
```

è¿‡ç¨‹ï¼š

```sql
create procedure p (in a1 type1, out a2 type2, inout a3 type3, ...)
    begin
    ...
end;

declare a2 type2;
call p(a1, a2, a3, ...);
```

å¸¸ç”¨è¯­å¥ï¼š

```sql
while ... do
    ...
end while;

repeat 
    ...
until ...
end repeat;

declare n interger default 0;
for r as 
    select ... from ...
    where ...
do
    set n = n + r.budget
end for;

if ... then
    ...
elseif ... then
    ...
else
    ...
end if;
```

## ç¬¬å…­ç«  E-R æ¨¡å‹

è®¾è®¡æ•°æ®åº“çš„ä¸¤ç§æ¨¡å¼ï¼šER æ¨¡å‹ã€èŒƒå¼ç†è®ºã€‚

- Entityï¼šç”± attributes æè¿°ï¼Œå¦‚ `instructor=(ID, name, dept_name, salary)`
- Relationshipï¼šå¤šä¸ª entities ä¹‹é—´çš„è”ç³»ã€‚Relationshop Sets è¡¨ç¤ºä¸ºï¼š$\{(e_1, e_2, ..., e_n)|e_i \in E_i\}$
- æ•´ä½“ç”¨ ER å›¾è¡¨ç¤º
- åŸºæœ¬æ¦‚å¿µï¼šentity setsã€relationship setsã€attributes

### Relationship Set

- å¯ä»¥æœ‰ attributes
- Degreeï¼šrelationship çš„å…ƒç´ ä¸ªæ•°ã€‚ä¸€èˆ¬éƒ½æ˜¯äºŒå…ƒå…³ç³» binary relationshipã€‚

### Attribute

- Simple/Composite
- Single-Valued/Multi-Valued
- Derived
- Domainï¼šå±æ€§çš„å–å€¼èŒƒå›´

### E-R æ¨¡å‹

- åŸºæœ¬æ¦‚å¿µï¼šå®ä½“é›†ã€å…³ç³»é›†ã€å±æ€§
- entity set, extension of the entity set, attributes possessed by each member of an entity set, simple attributes, composite and multivalued attributes, value
- relationships of the same type, relationship instance, participation, entity's role, descriptive attributes, degree of the relationship set
- Complex Attributes: domain (value set), simple, composite, single-valued, multivalued, derived
- Mapping Cardinalities: one-to-one, one-to-many, ..., total, partial participation, minimum and maximum cardinality
- Primary Key: primary key of the "many" side is a minimal superkey, replace the non-binary relationship set as an entity, weak entity set, identifying entity set, discriminator attributes, strong entity set, existence dependent, own, identifying relationship
- Removing Redundant Attributes in Entity Sets: <!-- Skip From 6.6 -->

### å…³ç³»å‹æ•°æ®åº“

æ ‡å‡†åŒ–æ–¹æ³•ï¼š

- ä¸€ä¸ªç»™å®šçš„å…³ç³»æè¦æ˜¯ä¸æ˜¯å¥½çš„å½¢å¼
- å¦‚æœä¸æ˜¯ï¼Œæ— æŸåˆ†è§£ä¸ºæ›´å°çš„å…³ç³»æè¦

## ç¬¬å…­éƒ¨åˆ†ï¼šæŸ¥è¯¢å¤„ç†ä¸ä¼˜åŒ–

æŸ¥è¯¢éœ€è¦è¢«åˆ†è§£æˆèƒ½ç”¨å…³ç³»ä»£æ•°è¡¨ç¤ºçš„æ“ä½œã€‚æœ‰å¤šç§åˆ†è§£æ–¹æ³•ï¼Œéœ€è¦æ‰¾åˆ°ä»£ä»·æœ€ä½çš„ã€‚

// TODOï¼šæŸ¥è¯¢è¿‡ç¨‹

### ç¬¬åäº”ç« ï¼šæŸ¥è¯¢å¤„ç†

æœ¬ç« å­¦ä¹ å¯¹å„ç§æ“ä½œè¿›è¡Œä¼°å€¼çš„ç®—æ³•ï¼Œä»¥åŠå¦‚ä½•ä¼°è®¡è¿™äº›æ“ä½œçš„ä»£ä»·ã€‚

### ç¬¬åå…­ç« ï¼šæŸ¥è¯¢ä¼˜åŒ–

## ç¬¬ä¸ƒéƒ¨åˆ†ï¼šäº‹åŠ¡ç®¡ç† Transaction Management

- äº‹åŠ¡ï¼šé€»è¾‘ä¸Šçš„ä¸€ç»„æ“ä½œã€‚
- åŸå­æ€§ï¼ˆatomicityï¼‰ï¼šè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œã€‚
- æŒä¹…æ€§ï¼ˆdurabilityï¼‰ï¼šä¸€æ—¦äº‹åŠ¡æäº¤ï¼Œå…¶ç»“æœå°±æ˜¯æ°¸ä¹…çš„ã€‚
- éš”ç¦»ï¼ˆisolationï¼‰ï¼šå¹¶å‘æ‰§è¡Œçš„äº‹åŠ¡ä¹‹é—´éœ€è¦éš”ç¦»ï¼Œä¸åº”è¯¥äº’ç›¸å½±å“ã€‚
- ä¸€è‡´æ€§ï¼ˆconsistencyï¼‰ï¼šäº‹åŠ¡æ‰§è¡Œå‰åï¼Œæ•°æ®åº“åº”è¯¥ä¿æŒä¸€è‡´æ€§ã€‚

äº‹åŠ¡çš„ä»¥ä¸Šæ€§è´¨åˆç§°ä¸º ACID ç‰¹æ€§ã€‚

### ç¬¬åä¸ƒç« ï¼šäº‹åŠ¡ Transaction

!!! abstract

    è®²è§£äº‹åŠ¡çš„æŠ½è±¡çš„æ€§è´¨ã€‚ä»‹ç»ç”¨å¯ä¸²è¡ŒåŒ–ï¼ˆserializabilityï¼‰æ¥æè¿°äº‹åŠ¡çš„éš”ç¦»æ€§ã€‚

#### äº‹åŠ¡æ¨¡å‹

åœ¨æœ¬ç« å»ºç«‹çš„æ¨¡å‹ä¸­ï¼Œè€ƒè™‘äº‹åŠ¡å¯¹æ•°æ®æ‰§è¡Œä¸¤ç±»ç®€å•æ“ä½œï¼š`read(X)` å’Œ `write(X)`ï¼Œåˆ†åˆ«è¡¨ç¤ºä»ç¡¬ç›˜è¯»å–æ•°æ®åˆ°å†…å­˜å’Œå°†å†…å­˜ä¸­çš„æ•°æ®å†™å›ç¡¬ç›˜ã€‚å¹¶ä¸”ï¼Œ`write(X)` æ“ä½œç«‹å³å‘ç”Ÿã€‚åœ¨ç¬¬åä¹ç« æ¢å¤ç®¡ç†ä¸­ï¼Œä¼šè®¨è®ºä½•æ—¶å°†æ•°æ®å†™å›ç¡¬ç›˜ã€‚

ä¸€ä¸ªç¤ºä¾‹çš„äº‹åŠ¡å¦‚ï¼š

```text
T1: read(A); A := A - 50; write(A)
```

äº‹åŠ¡å…·æœ‰çŠ¶æ€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

```mermaid
stateDiagram-v2
    A: Active
    B: Partially Committed
    C: Committed
    D: Failed
    E: Aborted
    A --> B
    B --> C
    A --> D
    B --> D
    D --> E: Rollback
```

- å®ç°åŸå­æ€§ï¼šç”±æ¢å¤ç³»ç»Ÿï¼ˆrecovery systemï¼‰è´Ÿè´£ã€‚
    -æ‰€æœ‰å¯¹æ•°æ®åº“çš„æ›´æ”¹ï¼ˆmodificationï¼‰éƒ½åœ¨æ‰§è¡Œå‰å…ˆå†™å…¥æ—¥å¿—ï¼ˆlogï¼‰ä¸­ã€‚è®°å½•çš„å†…å®¹åŒ…æ‹¬äº‹åŠ¡ã€æ•°æ®ã€æ–°æ—§å€¼ã€‚
    - å¦‚æœäº‹åŠ¡æ²¡æœ‰æˆåŠŸæ‰§è¡Œï¼ˆabortï¼‰ï¼Œå°±åº”å½“ç”±æ¢å¤ç³»ç»Ÿæ‰§è¡Œå€ŸåŠ©æ—¥å¿—ï¼ˆlogï¼‰è¿›è¡Œå›æ»šï¼ˆroll backï¼‰ã€‚
- å®ç°æŒä¹…æ€§ï¼šåŒæ ·ç”±æ¢å¤ç³»ç»Ÿè´Ÿè´£ã€‚ç¬¬åä¹ç« å°†è®¨è®ºå¦‚ä½•åº”å¯¹ç¡¬ç›˜ä¸Šçš„æ•°æ®ä¸¢å¤±ã€‚æœ¬ç« è€ƒè™‘ä¸»å­˜ä¸­çš„æ•°æ®ä¸¢å¤±ï¼Œå¯ä»¥é€šè¿‡ï¼š
    - å†™å›å®Œæˆåå†è¿”å›äº‹åŠ¡å®Œæˆ
    - äº‹åŠ¡æ›´æ–°çš„æœ‰å…³ä¿¡æ¯å†™å…¥ç£ç›˜ï¼Œä»¥ä¾¿æ•…éšœæ¢å¤åé‡å»º
- å®ç°éš”ç¦»ï¼šä¸€ç§åŠæ³•æ˜¯ä¸²è¡Œæ‰§è¡Œã€‚å¹¶å‘æ‰§è¡Œç”±å¹¶å‘æ§åˆ¶ç³»ç»Ÿï¼ˆconcurrency control systemï¼‰è´Ÿè´£ã€‚

#### äº‹åŠ¡çš„è°ƒåº¦

- è°ƒåº¦ï¼ˆscheduleï¼‰ï¼šç”¨äºè¡¨ç¤ºäº‹åŠ¡ä¸­çš„å…·ä½“æŒ‡ä»¤ï¼ˆinstructionï¼‰çš„æ‰§è¡Œé¡ºåºã€‚
    - ä¸åŒäº‹åŠ¡ä¸­è®¿é—®ç›¸åŒæ•°æ®çš„æŒ‡ä»¤ï¼Œåªè¦å…¶ä¸­ä¸€ä¸ªä¸ºå†™æŒ‡ä»¤ï¼Œå°±ä¼šäº§ç”Ÿå†²çªã€‚
    - ä¸å†²çªçš„æŒ‡ä»¤å¯ä»¥äº¤æ¢æ‰§è¡Œé¡ºåºã€‚èƒ½é€šè¿‡äº¤æ¢é¡ºåºå¾—åˆ°çš„è°ƒåº¦ç§°ä¸ºå†²çªç­‰ä»·ã€‚
- å†²çªå¯ä¸²è¡ŒåŒ–ï¼ˆconflict serializableï¼‰ï¼šä¸€ä¸ªè°ƒåº¦æ˜¯æŸä¸ªå¯ä¸²è¡Œï¼ˆserialï¼‰è°ƒåº¦çš„ç­‰ä»·ã€‚

!!! example

    ```text
        T1   |   T2
     read(A) | 
     write(A)|
             | read(A)
             | write(A)
     read(B) |
     write(B)|
    ```

    ç­‰ä»·äºä¸‹é¢è¿™ä¸ªä¸²è¡Œçš„è°ƒåº¦ï¼š

    ```text
        T1   |   T2
             | read(A)
             | write(A)
     read(A) | 
     write(A)| 
     read(B) |
     write(B)|
    ```

- è§†å›¾ç­‰ä»·ï¼ˆview equivalentï¼‰ï¼šä¸¤ä¸ªè°ƒåº¦ä¸­äº‹åŠ¡è¯»å–å’Œå†™å…¥çš„æ•°æ®å‡ç›¸åŒã€‚
- è§†å›¾å¯ä¸²è¡ŒåŒ–ï¼ˆview serializableï¼‰ï¼šè§†å›¾ç­‰ä»·äºæŸä¸ªå¯ä¸²è¡Œè°ƒåº¦ã€‚

!!! example

    è§†å›¾å¯ä¸²è¡ŒåŒ–ä½†ä¸å†²çªå¯ä¸²è¡ŒåŒ–çš„ä¾‹å­ï¼š

    ```text
        T1   |   T2     |   T3
     read(A) |          |
             | write(A) |
     write(A)|          |
             |          | write(A)
    ```

    è¿™æ ·çš„è°ƒåº¦æœ‰ç›²å†™ï¼ˆblind writeï¼‰çš„é—®é¢˜ã€‚

- å‰é©±å›¾ï¼ˆprecedence graphï¼‰ï¼šç”¨äºåˆ¤æ–­ä¸€ä¸ªè°ƒåº¦æ˜¯å¦å¯ä¸²è¡ŒåŒ–ã€‚
    - èŠ‚ç‚¹è¡¨ç¤ºäº‹åŠ¡
    - è¾¹è¡¨ç¤ºä¸€ä¸ªäº‹åŠ¡çš„æ“ä½œä¾èµ–äºå¦ä¸€ä¸ªäº‹åŠ¡çš„æ“ä½œï¼ˆå³è¯»å–äº†å¦ä¸€ä¸ªäº‹åŠ¡çš„å†™å…¥ç»“æœï¼‰
    - å¦‚æœå›¾ä¸­æ²¡æœ‰ç¯ï¼ˆacyclicï¼‰ï¼Œé‚£ä¹ˆè°ƒåº¦æ˜¯å¯ä¸²è¡ŒåŒ–çš„ï¼Œä¸²è¡ŒåŒ–çš„ç»“æœå°±æ˜¯å‰é©±å›¾çš„æ‹“æ‰‘æ’åºã€‚

```mermaid
graph TD
    T1 --> T2
    T2 --> T3
    T3 --> T1
```

- å¯æ¢å¤è°ƒåº¦ï¼ˆrecoverable scheduleï¼‰ï¼šå¦‚æœäº‹åŠ¡ T2 è¯»å–äº†äº‹åŠ¡ T1 çš„å†™å…¥ç»“æœï¼Œé‚£ä¹ˆ T1 å¿…é¡»åœ¨ T2 ä¹‹å‰æäº¤ï¼ˆcommitï¼‰ã€‚å¦åˆ™å°±ä¼šå‡ºç°å¹»è¯»ç­‰é—®é¢˜ã€‚
- çº§è”å›æ»šï¼ˆcascading rollbackï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡çš„å›æ»šå¯¼è‡´å…¶ä»–äº‹åŠ¡çš„å›æ»šã€‚æ¯”å¦‚ä¸€ä¸ªäº‹åŠ¡å†™å…¥çš„æ•°æ®æ­¤åè¢«å¤šä¸ªäº‹åŠ¡ä½¿ç”¨ï¼Œç„¶åè¯¥äº‹åŠ¡å›æ»šï¼Œé‚£ä¹ˆå…¶ä»–äº‹åŠ¡ä¹Ÿéœ€è¦å›æ»šã€‚
- æ— çº§è”è°ƒåº¦ï¼ˆcascadeless scheduleï¼‰ï¼šä¸å­˜åœ¨çº§è”å›æ»šçš„è°ƒåº¦ã€‚
    - è¯»å–æŸä¸ªäº‹åŠ¡çš„å†™å…¥ç»“æœå‰ï¼Œä¿è¯è¯¥äº‹åŠ¡å·²ç»æäº¤å³å¯ã€‚
    - æ— çº§è”è°ƒåº¦æ˜¯å¯æ¢å¤çš„ã€‚

#### å¹¶å‘æ§åˆ¶

æ‰€æœ‰è°ƒåº¦éƒ½æ˜¯å†²çªæˆ–è§†å›¾å¯ä¸²è¡ŒåŒ–ï¼ˆconflict/ view serializableï¼‰çš„ï¼Œå¯æ¢å¤çš„ï¼ˆrecoverableï¼‰å’Œæ— çº§è”çš„ï¼ˆcascadelessï¼‰ã€‚

#### ä¸€è‡´æ€§çº§åˆ« Levels of Consistency

- ä¸²è¡Œï¼ˆserializableï¼‰ï¼šé»˜è®¤
- å¯é‡å¤è¯»ï¼ˆrepeatable readï¼‰ï¼šåªè¯»å–å·²æäº¤çš„æ•°æ®
- è¯»å·²æäº¤ï¼ˆRead commitedï¼‰ï¼šè¯»å–å·²æäº¤çš„æ•°æ®
- è¯»æœªæäº¤ï¼ˆRead uncommitedï¼‰ï¼šè¯»å–æœªæäº¤çš„æ•°æ®

### ç¬¬åå…«ç« ï¼šå¹¶å‘æ§åˆ¶ Concurrency Control

!!! abstract

    ä»‹ç»å‡ ç§å¹¶å‘æ§åˆ¶æŠ€æœ¯ä»¥ä¿è¯äº‹åŠ¡éš”ç¦»ï¼šå°é”ï¼ˆlockï¼‰ã€æ—¶é—´æˆ³ï¼ˆtimestampï¼‰ã€å¤šç‰ˆæœ¬ï¼ˆmultiversionï¼‰ã€‚

#### å¹¶å‘æ‰§è¡Œå¯èƒ½äº§ç”Ÿçš„å‡ ç§é—®é¢˜

- ä¸¢å¤±æ›´æ–°ï¼ˆlost updateï¼‰ï¼šä¸¤ä¸ªäº‹åŠ¡åŒæ—¶è¯»å–æ•°æ®ï¼Œç„¶åä¸€ä¸ªäº‹åŠ¡æ›´æ–°æ•°æ®ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡å†æ›´æ–°æ•°æ®ã€‚
- è„è¯»ï¼ˆdirty readï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡è¯»å–äº†å¦ä¸€ä¸ªäº‹åŠ¡çš„ä¸­é—´ç»“æœã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªäº‹åŠ¡è¯»å–äº†å¦ä¸€ä¸ªäº‹åŠ¡æ›´æ–°çš„æ•°æ®ï¼Œä½†éšåå¦ä¸€ä¸ªäº‹åŠ¡å›æ»šäº†ã€‚
- ä¸å¯é‡å¤è¯»ï¼ˆnonrepeatable readï¼‰ï¼šå­—é¢æ„æ€ã€‚éš”ç¦»æ€§åº”å½“ä¿è¯äº‹åŠ¡è¿ç»­ä¸¤æ¬¡è¯»å–ç›¸åŒæ•°æ®è·å¾—çš„å€¼ä¸€æ ·ã€‚
- å¹»è¯»ï¼ˆphantom readï¼‰ï¼šç›¸åŒçš„æŸ¥è¯¢åœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­è¿”å›ä¸åŒçš„ç»“æœã€‚æˆ–è€…ç¬¬äºŒæ¬¡è¯»å–ç›¸åŒæ•°æ®æ—¶è¢«å‘ŠçŸ¥ä¸å­˜åœ¨ã€‚

### ç¬¬åä¹ç« ï¼šæ¢å¤ç®¡ç† Recovery Management

## å…³ç³»å‹æ•°æ®åº“

!!! abstract "çŸ¥è¯†ç»“æ„"

    ä¸»è¦ä¾æ®çš„ä¹¦ç±ä¸ºï¼š

    - MySQL Crash Course å…¥é—¨
    - MySQL Cookbook æ·±å…¥ç†è§£

    å¯ä»¥æŒ‰ä¸¤ç§æ–¹å¼æ¢³ç† MySQL çš„çŸ¥è¯†ï¼š

    - è¯­å¥
    - å¯¹è±¡

    éœ€è¦æŒæ¡çš„è¯­å¥ï¼š

    ```text
    SHOW, CREATE, SELECT, ...
    ```

    éœ€è¦æŒæ¡çš„å¯¹è±¡ï¼š

    - æ•°æ®åº“
    - è¡¨
    - å‡½æ•°
    - è§†å›¾
    - å­˜å‚¨è¿‡ç¨‹
    - æ¸¸æ ‡
    - äº‹åŠ¡

### æ•°æ®ç±»å‹

==todo==

### è¯­å¥

- `CREATE`ï¼šçŸ¥é“æ•°æ®åº“ã€è¡¨ã€è§†å›¾ã€ç´¢å¼•ã€è¿‡ç¨‹ã€ç”¨æˆ·æ€ä¹ˆåˆ›å»º

    ```mysql
    # æ•°æ®åº“
    CREATE DATABASE databasename;
    # è¡¨
    CREATE TABLE tablename
    (
        column datatype [NULL|NOT NULL] [CONSTRAINTS],
        #...
    );
    # è§†å›¾
    CREATE [OR REPLACE] VIEW viewname
    AS
    SELECT 
    #...
    ;
    # ç´¢å¼•
    CREATE INDEX indexname
    ON tablename (column [ASC|DESC], ...);
    # è¿‡ç¨‹
    CREATE PROCEDURE procedurename( [parameters] )
    BEGIN
    #...
    END;
    # ç”¨æˆ·
    CREATE USER username[@hostname]
    [IDENTIFIED BY [PASSWORD] 'password'];
    ```

- `SELECT`ï¼š

    ```mysql
    SELECT columnname [AS name], ...
    FROM tablename, ...
    [WHERE
    GROUP BY 
    HAVING 
    ORDER BY columnname [ASC|DESC]
    LIMIT start OFFSET offset];
    ```

    - å˜ç§ï¼š
        - `SELECT DISTINCT` åº”ç”¨äºæ‰€æœ‰é€‰æ‹©çš„åˆ—
        - `SELECT Concat(a, 'b', ...)` æ‹¼æ¥å­—æ®µï¼Œå¯ä»¥ç»“åˆ `RTrim()` ç­‰å‡½æ•°
    - `ORDER BY`
        - å¯ä»¥ä½¿ç”¨éæ£€ç´¢åˆ—
    - `WHERE`
        - æ“ä½œç¬¦ `= <> != < <= > >=` `BETWEEN AND` `IS NULL` `IN (val1, val2, ...)`
        - ç»„åˆå­å¥ï¼š`AND OR`ï¼Œæœ€å¥½ä½¿ç”¨åœ†æ‹¬å·
        - å–åï¼š`NOT` å¯ç”¨äº `IN`ã€`BETWEEN`ã€`EXISTS` å­å¥
        - `LIKE` åŒ¹é…æ•´ä¸ªåˆ—ï¼ˆå®Œå…¨åŒ¹é…ï¼‰
            - é€šé…ç¬¦ï¼š`%` ä»»æ„å­—ç¬¦ä»»æ„æ¬¡æ•°ï¼Œä½†ä¸åŒ¹é… `NULL`ï¼›`_` å•ä¸ªå­—ç¬¦ã€‚
        - `REGEXP` åœ¨åˆ—å€¼å†…è¿›è¡ŒåŒ¹é…ï¼ˆéƒ¨åˆ†åŒ¹é…ï¼‰
            - `.` ä»»æ„å•å­—ç¬¦
            - `a|b` å…¶ä¸­ä¹‹ä¸€
            - `[abC]` å…¶ä¸­ä¸€ä¸ªå­—ç¬¦ï¼Œ`[^abC]` å¦å®šï¼Œ`[a-z]` èŒƒå›´ï¼Œ`[:alnum:]` å­—ç¬¦ç±»
            - `\\` å‰å¯¼åŒ¹é…ç‰¹æ®Šå­—ç¬¦å’Œå…ƒå­—ç¬¦ï¼Œå¦‚ `\\n`ï¼Œè‡ªèº«ä¸º `\\\`

                !!! question "ä¸ºä»€ä¹ˆæ˜¯ä¸¤ä¸ªæ–œæ "

                    MySQL è‡ªå·±è§£é‡Šä¸€ä¸ªï¼Œæ­£åˆ™è¡¨è¾¾å¼åº“è§£é‡Šå¦ä¸€ä¸ªã€‚

            - é‡å¤å…ƒå­—ç¬¦ï¼š`*` 0 æˆ–å¤šä¸ªï¼Œ`+` 1 æˆ–å¤šä¸ªï¼Œ`?` 0 æˆ– 1ï¼Œ`{n}` æŒ‡å®šæ•°ç›®ï¼Œ`{n,m}` æŒ‡å®šèŒƒå›´ã€‚ç”¨ä¾‹ï¼š`[[:digit:]]{4}`
            - å®šä½ç¬¦ï¼š`^` å¼€å§‹ï¼Œ`$` ç»“å°¾ï¼Œ`[[:<:]] [[:<:]]` è¯å¼€å§‹ç»“å°¾

        !!! note "`NULL` çš„æ¯”è¾ƒ"

            MySQL ä½¿ç”¨ä¸‰å€¼é€»è¾‘ â€”â€” TRUE, FALSE å’Œ UNKNOWNã€‚ä»»ä½•ä¸ NULL å€¼è¿›è¡Œçš„æ¯”è¾ƒéƒ½ä¼šä¸ç¬¬ä¸‰ç§å€¼ UNKNOWN åšæ¯”è¾ƒã€‚è¿™ä¸ªâ€œä»»ä½•å€¼â€åŒ…æ‹¬ NULL æœ¬èº«ï¼ä¹Ÿå°±æ˜¯è¯´ï¼š`NULL = NULL` æ˜¯é”™çš„ã€‚
            
            åº”å½“ä½¿ç”¨ IS NULL å’Œ IS NOT NULL ä¸¤ç§æ“ä½œæ¥å¯¹ NULL ç‰¹æ®Šåˆ¤æ–­ã€‚

- `ALTER TABLE tablename` ä»…åˆ—å‡ºéƒ¨åˆ†å¸¸ç”¨ï¼š
  
    ```mysql
    ALTER TABLE tbl_name
      [alter_option [, alter_option] ...]
      [partition_options];
    alter_option: {
        table_options
      | ADD [COLUMN] col_name column_definition
            [FIRST | AFTER col_name]
      | DROP {CHECK | CONSTRAINT} symbol
      | ALTER {CHECK | CONSTRAINT} symbol [NOT] ENFORCED
      | CHANGE [COLUMN] old_col_name new_col_name column_definition
            [FIRST | AFTER col_name]
      | DROP [COLUMN] col_name
      | DROP {INDEX | KEY} index_name
      | DROP PRIMARY KEY
      | DROP FOREIGN KEY fk_symbol
      | LOCK [=] {DEFAULT | NONE | SHARED | EXCLUSIVE}
      | MODIFY [COLUMN] col_name column_definition
            [FIRST | AFTER col_name]
      | ORDER BY col_name [, col_name] ...
      | RENAME COLUMN old_col_name TO new_col_name
      | RENAME {INDEX | KEY} old_index_name TO new_index_name
      | RENAME [TO | AS] new_tbl_name
    }
    table_option: {
        AUTOEXTEND_SIZE [=] value
      | AUTO_INCREMENT [=] value
      | AVG_ROW_LENGTH [=] value
      | ENGINE [=] engine_name
      | ENGINE_ATTRIBUTE [=] 'string'
      | INSERT_METHOD [=] { NO | FIRST | LAST }
      | UNION [=] (tbl_name[,tbl_name]...)
    }
    ```

### è§†å›¾

è§†å›¾æ˜¯è™šæ‹Ÿçš„è¡¨ï¼Œä½¿ç”¨æ—¶åŠ¨æ€æ£€ç´¢æ•°æ®ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåŒ…è£…çš„æŸ¥è¯¢ï¼Œå¯ä»¥ç”¨ä¸è¡¨åŸºæœ¬ç›¸åŒçš„æ–¹å¼åˆ©ç”¨ã€‚

è§†å›¾çš„å¸¸ç”¨åœºæ™¯ï¼š

- å­˜å‚¨ä¸€ä¸ªåŸºç¡€çš„æŸ¥è¯¢ï¼Œå¤šæ¬¡ä½¿ç”¨
- ç»“åˆè®¡ç®—å­—æ®µï¼Œå¯¹æ•°æ®è¿›è¡Œæ ¼å¼åŒ–
- è¿‡æ»¤ä¸æƒ³è¦çš„æ•°æ®

ä½¿ç”¨æ–¹æ³•ï¼š

- å¯ä»¥åµŒå¥—
- ä¸èƒ½ç´¢å¼•
- å¯ä»¥å’Œè¡¨ä¸€èµ·ä½¿ç”¨ï¼Œæ¯”å¦‚å’Œè¡¨è”ç»“
- å¯ä»¥ `ORDER BY`

å…·ä½“æ“ä½œï¼š

```sql
CREATE VIEW view_name AS;
SHOW CREATE VIEW view_name;
CREATE OR REPLACE VIEW view_name AS;
```

æ›´æ–°è§†å›¾ï¼šè§†å›¾çš„æ›´æ–°æ˜¯å¯¹åŸºç¡€è¡¨çš„æ›´æ–°ã€‚åªè¦å‡ºç°äº†åˆ†ç»„ã€è”ç»“ã€å­æŸ¥è¯¢ã€å¹¶ç­‰æ“ä½œï¼Œå°±ä¸èƒ½æ›´æ–°è§†å›¾ã€‚å¤§éƒ¨åˆ†è§†å›¾éƒ½æ˜¯ä¸èƒ½æ›´æ–°çš„ã€‚

### å‡½æ•°

```sql
Concat()
# æ–‡æœ¬
Left, Right; Length; Locate, SubString; Lower, Upper; LTrim, Trim, RTrim; Soundex
# æ—¥æœŸ
Date, Time, Year, Month, Day, Hour, Minute, Second; Now, CurDate, CurTime; AddDate, AddTime; DateDiff; Date_Add, Date_Format; DayOfWeek
# æ•°å€¼
Abs, Cos, Exp, Mod, Pi, Rand, Sin, Sqrt, Tan
```

!!! note "æ—¥æœŸ"

    å¦‚æœè¦çš„æ˜¯æ—¥æœŸï¼Œè¯·ä½¿ç”¨Date() æ¯”å¦‚ï¼Œå­˜å‚¨çš„order_date å€¼ä¸º2005-09-01 11:30:05ï¼Œåˆ™WHERE order_date = '2005-09-01'å¤±è´¥ã€‚

!!! note "å­—ç¬¦"

    å»ºè®®ä½¿ç”¨ `CHAR_LENGTH` è€Œä¸æ˜¯ `LENGTH`ï¼Œå› ä¸º `LENGTH` å¯¹ç‰¹æ®Šå­—ç¬¦å¯èƒ½è¿”å›æ„æƒ³ä¸åˆ°çš„ç»“æœã€‚æ¯”å¦‚å¯¹äº `Â¥`ï¼Œå‰è€…è¿”å› 1ï¼Œåè€…è¿”å› 2ã€‚

### è§¦å‘å™¨

è§¦å‘å™¨æ˜¯ä¸€äº›è¯­å¥ï¼Œåœ¨äº‹ä»¶å‘ç”Ÿæ—¶è‡ªåŠ¨æ‰§è¡Œã€‚MySQL è§¦å‘å™¨èƒ½å¤Ÿç›¸åº” `DELETE`ã€`INSERT`ã€`UPDATE` äº‹ä»¶ã€‚

```sql
CREATE TRIGGER trigger_name
BEFORE|AFTER DELETE|INSERT|UPDATE
ON table_name
FOR EACH ROW
BEGIN
    -- ...
END;
```

- å¯¹äºæ¯ä¸ªè¡¨æ¯ä¸ªäº‹ä»¶åªå…è®¸ä¸€ä¸ªè§¦å‘å™¨ï¼Œå› æ­¤æ¯ä¸ªè¡¨æœ€å¤šæœ‰ 6 ä¸ªè§¦å‘å™¨ã€‚
- å¦‚æœ `BEFORE` è§¦å‘å™¨å¤±è´¥ï¼Œæ“ä½œä¸æ‰§è¡Œï¼›å¦‚æœæ“ä½œå¤±è´¥ï¼Œ`AFTER` è§¦å‘å™¨ä¸æ‰§è¡Œã€‚

### è”ç»“

å¾ˆå¤šå­æŸ¥è¯¢éƒ½å¯ä»¥ä½¿ç”¨è”ç»“å®Œæˆã€‚

è‡ªè”ç»“å¾ˆç®€å•ï¼Œç”¨åˆ«åç†è§£å³å¯ã€‚

#### å†…éƒ¨è”ç»“ `INNER JOIN`

å†…éƒ¨è”ç»“å¾—åˆ°ç¬›å¡å°”ç§¯ã€‚ä¼ é€’ç»™ `ON` çš„æ¡ä»¶å’Œç›´æ¥ä½¿ç”¨ `WHERE` å»ºç«‹è”ç»“ç›¸åŒï¼š

```mysql
SELECT * FROM a, b WHERE a.a = b.a;
SELECT * FROM a INNER JOIN b ON a.a=b.a;
```

ç”¨äºè”ç»“çš„åˆ—ä¼šé‡å¤å‡ºç°ã€‚æ‰‹åŠ¨æŒ‡å®šéœ€è¦çš„åˆ—å°±æ˜¯æ‰€è°“çš„â€œè‡ªç„¶è”ç»“â€ã€‚

#### å¤–éƒ¨è”ç»“ `LEFT|RIGHT OUTER JOIN`

éœ€è¦åŒ…å«æ²¡æœ‰å…³è”è¡Œçš„é‚£äº›è¡Œæ—¶ï¼Œä½¿ç”¨å¤–éƒ¨è”ç»“ã€‚`LEFT|RIGHT` æŒ‡å®šä»å“ªä¸€ä¾§çš„è¡¨æ ¼é€‰æ‹©æ‰€æœ‰è¡Œã€‚

```mysql
SELECT * FROM a LEFT OUTER JOIN b ON a.a=b.a;
```

#### äº¤å‰è”ç»“ `CROSS JOIN`

### çº¦æŸ

#### å¤–é”®

##### `ON` å­å¥

å¯ä»¥åœ¨å¤–é”®è¢« `UPDATE` æˆ– `DELETE` æ—¶æŒ‡å®šæ“ä½œï¼š

- `RESTRICT` é»˜è®¤ï¼Œæ‹’ç»æ“ä½œ
- `CASCADE` çº§è”æ“ä½œï¼Œåˆ é™¤æˆ–æ›´æ–°ä¸»è¡¨çš„è¡Œæ—¶ï¼Œä»è¡¨çš„è¡Œä¹Ÿä¼šè¢«åˆ é™¤æˆ–æ›´æ–°
- `SET NULL` ä»è¡¨çš„å¤–é”®åˆ—è¢«è®¾ç½®ä¸º `NULL`

#### `INSERT`

- `NEW` å…³é”®å­—å¼•ç”¨æ–°æ’å…¥çš„è¡Œ
- `AUTO_INCREMENT` åœ¨ `INSERT` æ‰§è¡Œåæ‰ç”Ÿæˆå€¼

å»ºè®®ï¼š

- `BEFORE` ç”¨äºæ•°æ®éªŒè¯å’Œå‡€åŒ–
- `AFTER` ç”¨äºæ—¥å¿—è®°å½•å’Œæ•°æ®å®¡è®¡

#### `DELETE`

- `OLD` å…³é”®å­—å¼•ç”¨è¢«åˆ é™¤çš„è¡Œï¼Œå…¨åªè¯»

#### `UPDATE`

- `OLD` å…³é”®å­—å¼•ç”¨è¢«æ›´æ–°çš„è¡Œï¼Œå…¨åªè¯»
- `NEW` å…³é”®å­—å¼•ç”¨æ–°æ’å…¥çš„è¡Œ

### äº‹åŠ¡

#### ä½¿ç”¨

äº‹åŠ¡å¤„ç†ï¼ˆtransaction processingï¼‰ç”¨äºç»´æŠ¤æ•°æ®åº“å®Œæ•´æ€§ï¼Œç¡®ä¿ä¸€æ‰¹æ“ä½œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œã€‚

ä¸‰ä¸ªæœ¯è¯­ï¼šRollbackã€Commitã€Savepoint

!!! warning "æ— æ³•å›é€€ `CREATE` æˆ– `DROP`"

!!! warning "`DROP DATABASE` ç­‰è¯­å¥æ— æ³•ä½œä¸ºäº‹åŠ¡çš„ä¸€éƒ¨åˆ†"

æ‰§è¡Œä¸€æ¡ `ROLLBACK` æˆ– `COMMIT` æ„å‘³ç€äº‹åŠ¡ç»“æŸã€‚

```mysql
# Example1 å›é€€
SELECT * FROM table;
START TRANSACTION;
DELETE FROM table;
SELECT * FROM table;
ROLLBACK;
SELECT * FROM table;

# Example2 å¤šè¡¨ä¸€è‡´æ€§
START TRANSACTION;
DELETE FROM table1 WHERE id=1;
DELETE FROM table2 WHERE id=1;
COMMIT;

# Example3 ä¿å­˜ç‚¹
START TRANSACTION;
DELETE FROM table1 WHERE id=1;
SAVEPOINT delete1;
DELETE FROM table2 WHERE id=1;
ROLLBACK TO delete1;
COMMIT;
```

#### é”

### å®‰å…¨

#### ç”¨æˆ·

```mysql
USE mysql;
SELECT user, host FROM user;
CREATE USER 'username'@'hostname' IDENTIFIED BY 'password';
RENAME USER 'oldname' TO 'newname';
DROP USER 'username'@'hostname';
SHOW GRANTS FOR 'username'@'hostname';
GRANT SELECT, INSERT, UPDATE, DELETE ON databasename.tablename TO 'username'@'hostname';
REVOKE SELECT, INSERT, UPDATE, DELETE ON databasename.tablename FROM 'username'@'hostname';
SET PASSWORD FOR 'username'@'hostname' = PASSWORD('newpassword');
```

### èšåˆä¸åˆ†ç»„

```sql
AVG, COUNT, MAX, MIN, SUM
```

- å¯ä¸ºè¿™äº›å‡½æ•°æŒ‡å®šDISTINCT
- å¦‚æœåœ¨GROUP BYå­å¥ä¸­åµŒå¥—äº†åˆ†ç»„ï¼Œæ•°æ®å°†åœ¨æœ€åè§„å®šçš„åˆ†ç»„ä¸Šè¿›è¡Œæ±‡æ€»ã€‚
- é™¤èšé›†è®¡ç®—è¯­å¥å¤–ï¼ŒSELECTè¯­å¥ä¸­çš„æ¯ä¸ªåˆ—éƒ½å¿…é¡»åœ¨GROUP BYå­å¥ä¸­ç»™å‡ºã€‚

> ğŸ¤”è¿™ä¸€ç‚¹æ˜¯åˆç†çš„ï¼Œå› ä¸ºå¦‚æœæœ‰æŸä¸€åˆ—è¢«é€‰æ‹©ï¼Œå´ä¸å¯¹å®ƒè¿›è¡Œåˆ†ç»„ï¼Œé‚£å®ƒçš„å€¼è¦æ€ä¹ˆæ˜¾ç¤ºï¼Ÿ

#### ç»„åˆæŸ¥è¯¢

- å¤šä¸ªSELECTè¯­å¥ä¹‹é—´ä½¿ç”¨UNIONåˆæˆä¸€ä¸ªç»“æœè¿”å›
- æ˜¾ç„¶ï¼Œæ¯ä¸ªæŸ¥è¯¢çš„åˆ—ã€è¡¨è¾¾å¼ç­‰å¿…é¡»ç›¸åŒã€å…¼å®¹
- ä¼šè‡ªåŠ¨å»é™¤é‡å¤è¡Œï¼Œä½¿ç”¨UNION ALLä¿ç•™ã€‚WHEREæ— æ³•å®ç°è¿™ç§ã€‚
- UNIONç»„åˆåªèƒ½ä½¿ç”¨ä¸€æ¡ORDER BYï¼Œå‡ºç°åœ¨æœ€åçš„SELECTä¹‹åã€‚

#### å…¨æ–‡æœ¬æœç´¢

- åŸç†æ˜¯ä¸ºæŒ‡å®šåˆ—ä¸­çš„è¯åˆ›å»ºç´¢å¼•ï¼Œæœç´¢é’ˆå¯¹è¿™äº›è¯è¿›è¡Œã€‚å¿«é€Ÿå†³å®šåŒ¹é…å’Œé¢‘ç‡ç­‰ã€‚
- åªæœ‰ MyISAM å¼•æ“æ”¯æŒï¼Œè€Œ InnoDB ä¸æ”¯æŒ
- åˆ›å»ºè¡¨æ—¶ä½¿ç”¨ `FULLTEXT` å­å¥

    ```sql
    CREATE TABLE a
    (
        FULLTEXT(a_column)
    ) ENGINE=MyISAM;
    ```

- ç”¨ `Match()` å’Œ `Against()` æ‰§è¡Œå…¨æ–‡æœ¬æœç´¢

    ```sql
    WHERE Match(note_text) Against('rabbit');
    ```

    - è¿™ä¸€è¡¨è¾¾å¼ç»™å‡ºå…¨æ–‡æœ¬æœç´¢çš„ rank
- æŸ¥è¯¢æ‰©å±• `WITH QUERY EXPANSION`
- å¸ƒå°”æ–‡æœ¬æœç´¢ `IN BOOLEAM MODE`ï¼Œå…¨æ–‡æœ¬å¸ƒå°”æ“ä½œç¬¦æŸ¥è¡¨
- æ­¤å¤–æœ‰ä¸€äº›ä½¿ç”¨ä¸Šçš„è¯´æ˜ï¼Œæ¯”å¦‚å‡ºç°é¢‘ç‡è¿‡é«˜çš„è¯è‡ªåŠ¨å¿½ç•¥ã€çŸ­è¯è‡ªåŠ¨å¿½ç•¥ã€ä¸­æ—¥æ–‡ç­‰æ— è¯åˆ†éš”ç¬¦çš„è¯­è¨€æ— æ³•æœç´¢ç­‰

### æ•°æ®ä¿®æ”¹

æ’å…¥ï¼š

```sql
INSERT INTO table() VALUE (), (), ...;
```

- é™¤äº† `VALUE`ï¼Œ`SELECT` çš„ç»“æœä¹Ÿå¯ä»¥æ’å…¥ï¼Œä¸” SQL ä¸å…³å¿ƒè¿”å›çš„åˆ—åï¼Œåªå…³å¿ƒä½ç½®ï¼Œè¿™æ ·å¯ä»¥ä»ä¸åŒè¡¨ä¸­å¯¼å…¥æ•°æ®

æ›´æ–°ï¼š

```sql
UPDATE table
SET col=newval, col=newval, ...
WHERE condition;
```

- å¯ä»¥ä½¿ç”¨å­æŸ¥è¯¢
- è‹¥å‘ç”Ÿé”™è¯¯åˆ™è¯¥æ›´æ–°çš„**å…¨éƒ¨æ“ä½œ**è¢«å–æ¶ˆï¼Œ`UPDATE IGNORE` å¿½ç•¥é”™è¯¯

åˆ é™¤ï¼š

```sql
DELETE table
WHERE condition;

TRUNCATE TABLE;
```

!!! warning "SQL æ²¡æœ‰æ’¤é”€æŒ‰é’®"

### è¡¨æ“ä½œ

`CREATE TABLE`

- `PRIMARY KEY ()` å…³é”®å­—æŒ‡å®šä¸»é”®ï¼Œå¯ä»¥æ˜¯å¤šä¸ªåˆ—
- `AUTO_INCREMENT` è‡ªåŠ¨å¢é‡
    - åœ¨ `INSERT` æ—¶ä»ç„¶å¯ä»¥æŒ‡å®šå€¼ï¼Œä¸”åç»­å¢é‡å°†åŸºäºè¯¥å€¼
    - `SELECT last_insert_id();` è·å¾—æœ€åä¸€ä¸ª `AUTO_INCREMENT` å€¼
- `NOT NULL` ä¸å…è®¸ç©ºå€¼
- `DEFAULT value` é»˜è®¤å€¼ï¼Œåªèƒ½æ˜¯å¸¸é‡
- `ENGINE=` æŒ‡å®šå¼•æ“
    - å¤–é”®ä¸èƒ½è·¨å¼•æ“
    - å¦‚æœéœ€è¦äº‹åŠ¡å¤„ç†ï¼Œä½¿ç”¨ InnoDB
    - å…¶ä½™æƒ…å†µéƒ½å¯ä»¥ç”¨ MyISAM
    - MEMORY å¼•æ“ï¼šä¸´æ—¶è¡¨ï¼Œå­˜æ”¾äºå†…å­˜

`DROP TABLE`

`RENAME TABLE a TO b, c TO d, ...;`

### å­˜å‚¨è¿‡ç¨‹

```mysql
CREATE PROCEDURE proc_name(
    OUT p1 INT,
    OUT p2 DECIMAL(5,2)
)
BEGIN
    -- ...
    SELECT *
    INTO p1
    FROM table;
END;

CALL proc_name(@p1, @p2);
SELECT @p1, @p2;
SHOW PROCEDURE STATUS LIKE 'proc_name';
```

å­˜å‚¨è¿‡ç¨‹çš„é‡ç‚¹åœ¨äºä¸šåŠ¡è§„åˆ™å’Œæ™ºèƒ½å¤„ç†ã€‚

```mysql
CREATE PROCEDURE proc_name(
) COMMENT 'some comment'
BEGIN

    DECLARE var_name INT;
    DECLARE CONTINUE HANDLER FOR SQLEXCEPTION
    BEGIN
        ROLLBACK;
    END;

    START TRANSACTION;
    -- ...
    COMMIT;

    IF condition THEN
        -- ...
    ELSEIF condition THEN
        -- ...
    ELSE
        -- ...
    END IF;
END;
```

### æ¸¸æ ‡

æ¸¸æ ‡æ˜¯ä¸€ä¸ªæŒ‡å‘ç»“æœé›†çš„æŒ‡é’ˆï¼Œå¯ä»¥ç”¨äºéå†ç»“æœé›†ã€‚ä½¿ç”¨æµç¨‹ï¼š

- å£°æ˜æ¸¸æ ‡
- æ‰“å¼€æ¸¸æ ‡ï¼ˆçœŸæ­£æ‰§è¡ŒæŸ¥è¯¢ï¼‰
- æ£€ç´¢æ•°æ®
- å…³é—­æ¸¸æ ‡

```mysql
DECLARE cur_name CURSOR FOR SELECT * FROM table;
OPEN cur_name;
FETCH cur_name INTO var1, var2;
DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;
REPEAT
    FETCH cur_name INTO var1, var2;
UNTIL done END REPEAT;
```

