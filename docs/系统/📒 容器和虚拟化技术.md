---
tags:
  - ä¸ªäººç¬”è®°
---

# ğŸ“’ å®¹å™¨å’Œè™šæ‹ŸåŒ–æŠ€æœ¯

## Docker åŸç†

!!! quote

    - [A Deep dive into Docker Storage - Medium](https://medium.com/geekculture/docker-storage-1dd3db3ded4c)

- é•œåƒæ„å»º
    - Docker é•œåƒæ„å»ºä¸ºå‰åç«¯æ¶æ„ï¼šBuildx ä¸ºå®¢æˆ·ç«¯ï¼ŒBuildKit ä¸ºæœåŠ¡ç«¯ã€‚
- å­˜å‚¨
    - é»˜è®¤æƒ…å†µ
        - ä½äº `/var/lib/docker`ï¼Œå¸è½½æ—¶ä¸ä¼šè‡ªåŠ¨æ¸…é™¤ã€‚
        - å±‚æ¬¡åŒ–ç»“æ„ï¼Œç”± Image å±‚ï¼ˆåªè¯»ï¼‰å’Œ Container å±‚ï¼ˆè¿è¡Œæ—¶æ•°æ®ï¼Œå¯å†™ï¼‰ç»„æˆã€‚å¦‚æœéœ€è¦ä¿®æ”¹ Image å±‚æ•°æ®ï¼Œé‡‡ç”¨ copy-on-write æ–¹å¼ã€‚
        - ä¸å®¹å™¨å¼ºç»‘å®šï¼Œå®¹å™¨åˆ é™¤åæ•°æ®ä¹Ÿæ¶ˆå¤±ã€‚
    - æŒä¹…åŒ–å­˜å‚¨
        - Volumeï¼š
            - åœ¨ `/var/lib/docker/volumes` ä¸‹åˆ›å»ºï¼Œä¸éšå®¹å™¨æ¶ˆå¤±ã€‚
            - å¯ä»¥æ”¾ç½®åœ¨è¿œç«¯å­˜å‚¨ã€‚
            - ä½¿ç”¨ `docker volume` å‘½ä»¤æ“ä½œï¼Œ
        - Bind mountï¼š
            - æŒ‚è½½å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚
            - å…è®¸æŒ‚è½½ NFSï¼ˆä½¿ç”¨ Docker è‡ªå·±çš„ NFS é©±åŠ¨ï¼Œå³ä¸éœ€è¦åœ¨å®¿ä¸»æœºä¸ŠæŒ‚è½½ï¼‰ã€‚
- ç½‘ç»œ
    - ç½‘ç»œå¯¹å®¹å™¨é€æ˜ï¼Œå®ƒåªèƒ½çœ‹åˆ°ä¸€ä¸ªå…·æœ‰ IP åœ°å€çš„ç½‘ç»œæ¥å£ã€ç½‘å…³ã€è·¯ç”±è¡¨å’Œ DNS æœåŠ¡ã€‚
    - åœ¨ Linux ä¸Šï¼ŒDocker ä½¿ç”¨ iptables å®ç°ç½‘ç»œã€‚ç›®å‰æœ‰è¿ç§»åˆ° nftables çš„è®¡åˆ’ã€‚
    - Docker è‡ªåŠ¨ä¸º `FORWARD` é“¾æ·»åŠ  `DROP` ç­–ç•¥ï¼Œé˜»æ­¢å®¿ä¸»æœºä½œä¸ºè·¯ç”±å™¨ã€‚å¦‚æœéœ€è¦ï¼Œåº”å½“æ‰‹åŠ¨æ·»åŠ è§„åˆ™ã€‚
    - æ”¯æŒçš„ç½‘ç»œé©±åŠ¨æœ‰ï¼š`bridge`ï¼ˆé»˜è®¤ï¼‰ã€`host`ã€`none`ã€`overlay`ã€`ipvlan`ã€`macvlan`ã€‚
    - `bridge`ï¼šéƒ¨ç½²æ—¶å»ºè®®ä½¿ç”¨ç”¨æˆ·å®šä¹‰çš„ `bridge` ç½‘ç»œã€‚
        - é»˜è®¤ç½‘æ¡¥ `bridge`ï¼š
            - è‡ªåŠ¨åˆ›å»ºï¼Œå®¹å™¨é»˜è®¤è¿æ¥åˆ°è¯¥ç½‘æ¡¥ã€‚
            - å®¹å™¨é—´åªèƒ½é€šè¿‡ IP åœ°å€é€šä¿¡ã€‚éœ€è¦ä½¿ç”¨ `--link` å‚æ•°åœ¨åŒæ–¹åˆ›å»ºè¿æ¥æ‰èƒ½ä½¿ç”¨è‡ªåŠ¨ DNSã€‚
            - å¿…é¡»åœæ­¢å®¹å™¨æ‰èƒ½ç§»å‡ºé»˜è®¤ç½‘æ¡¥ã€‚
        - ç”¨æˆ·å®šä¹‰ `bridge`ï¼š
            - è‡ªåŠ¨ DNS åŠŸèƒ½ï¼šå®¹å™¨å¯ä»¥ä½¿ç”¨ IP åœ°å€æˆ–**å®¹å™¨å**ç›¸äº’æ²Ÿé€šã€‚
            - çƒ­æ’æ‹”ï¼šä¸éœ€è¦å…³é—­å®¹å™¨å³å¯ç§»åŠ¨åˆ°å…¶ä»–ç½‘ç»œã€‚

    !!! note "Compose ä¸­çš„ç½‘ç»œ"

        Compose ä¼šè‡ªåŠ¨ä¸ºåº”ç”¨åˆ›å»ºä¸€ä¸ªç½‘ç»œï¼Œå®¹å™¨å¯ä»¥é€šè¿‡æœåŠ¡åç›¸äº’è®¿é—®ã€‚

    - `host`ï¼š
        - ç«¯å£æ˜ å°„ä¸ç”Ÿæ•ˆã€‚
    - ç«¯å£æ˜ å°„ï¼š
        - Docker ä½¿ç”¨ iptables è¿›è¡Œç›¸å…³ NATã€PNAT å’Œ masquerade æ“ä½œã€‚
        - é»˜è®¤æƒ…å†µä¸‹æ‰€æœ‰å¤–éƒ¨ä¸»æœºéƒ½èƒ½è®¿é—®å…¬å¼€ç«¯å£ï¼Œå¦‚æœéœ€è¦é™åˆ¶ï¼Œéœ€è¦è‡ªå·±å†™ iptables è§„åˆ™ã€‚
        - IPv6 ä¸‹å¯èƒ½é…ç½®ä¸ºç›´è¿è·¯ç”±ã€‚
        - `-p host:docker`
- å®¹å™¨
    - é‡å¯ç­–ç•¥ï¼š`no`ã€`always`ã€`unless-stopped`ã€`on-failure`ã€‚

### Docker å¸¸ç”¨å‘½ä»¤

```bash
# é•œåƒ
docker image save image > image.tar
docker image load < image.tar
```
